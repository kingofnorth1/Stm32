#include "UC1698.h"
#include "stm32f10x.h"                  // Device header


unsigned char  hanzi[]=
{
/* ????24x24
   ?????????????
   ?????????
   ???????C???? */

0x00,0x10,0x10, 0x10,0x10,0x10, 0x10,0x10,    // ??
0x90, 0xF0,0x78,0x1F, 0x16,0x12,0x10, 0x10,
0x10,0x90, 0x90,0x18,0x1C, 0x18,0x10,0x00,
0x00,0x40,0x40, 0x20,0x10,0x18, 0x0C,0xFF,
0xFF, 0x11,0x11,0x11, 0x11,0x11,0x11,  0x11,
0x11,0xFF, 0xFF,0x01,0x00, 0x00,0x00,0x00,
0x00,0x00,0x00, 0x00,0x00,0x00, 0x00,0xFF,
0x7F, 0x01,0x01,0x01, 0x01,0x21,0x21, 0x61,
0xE1,0x7F, 0x3F,0x00,0x00, 0x00,0x00,0x00,

0x00,0x00,0x00,0xFE,0xFC,0x04,0x04,0xE4,    // ??
0x3E,0x0E,0x04,0xFE,0xFC,0x44,0x44,0x44,
0x44,0x44,0x44,0xFE,0xFE,0x04,0x00,0x00,
0x00,0x00,0x00,0xFF,0xFF,0x80,0x83,0x84,
0xF8,0xF0,0x00,0xFF,0xFF,0x08,0x08,0x78,
0x88,0x08,0x88,0x5F,0x6F,0x30,0x20,0x00,
0x00,0x00,0x00,0xFF,0x7F,0x00,0x00,0x03,
0x01,0x00,0x40,0xFF,0x7F,0x30,0x10,0x08,
0x01,0x07,0x0C,0x18,0x30,0x70,0x20,0x20,

0x00,0x00,0x00,0x00,0x00,0x80,0xE0,0x78,    // ??
0x1E,0x0C,0x04,0x00,0x00,0x07,0x1A,0x60,
0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x20,0x10,0x0C,0x06,0x03,0x00,0x00,
0xC0,0xF0,0x3E,0x0C,0x04,0x00,0x80,0x00,
0x00,0x01,0x07,0x0E,0x1C,0x0C,0x08,0x00,
0x00,0x00,0x00,0x10,0x30,0x38,0x36,0x13,
0x11,0x10,0x10,0x10,0x10,0x10,0x10,0x11,
0x16,0x1C,0x78,0x30,0x00,0x00,0x00,0x00,

0x00,0x00,0x40,0x44,0x44,0x44,0x44,0x44,    // ?
0x44,0x44,0x44,0x44,0x44,0x44,0x44,0x64,
0x64,0x44,0x04,0xFE,0xFE,0x04,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0xFC,0xF8,0x08,
0x08,0x08,0x08,0x08,0x08,0xFC,0xFC,0x08,
0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x0F,0x07,0x02,
0x02,0x02,0x02,0x02,0x02,0x0F,0x07,0x20,
0x20,0x60,0xE0,0x7F,0x3F,0x00,0x00,0x00,
};

unsigned char zimu[]=
{
	/*--  ????:  c  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xF8,0x18,
0x04,0x04,0x04,0x3C,0x38,0x00,0x00,0x00,0x00,0x03,0x0F,0x0C,0x10,0x10,0x10,0x10,
0x08,0x06,0x00,0x00,

/*--  ????:  o  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xF0,0x18,
0x0C,0x04,0x04,0x0C,0x18,0xF0,0xE0,0x00,0x00,0x03,0x0F,0x0C,0x10,0x10,0x10,0x10,
0x0C,0x0F,0x03,0x00,

/*--  ????:  n  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0xFC,0xFC,
0x08,0x08,0x04,0x04,0xFC,0xF8,0x00,0x00,0x00,0x10,0x1F,0x1F,0x10,0x00,0x00,0x10,
0x1F,0x1F,0x10,0x00,

/*--  ????:  t  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x04,0x04,
0xFF,0xFF,0x04,0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x1F,0x10,0x10,
0x10,0x0C,0x00,0x00,

/*--  ????:  r  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x04,0x04,0xFC,
0xFC,0x10,0x08,0x04,0x04,0x0C,0x0C,0x00,0x10,0x10,0x10,0x1F,0x1F,0x10,0x10,0x10,
0x00,0x00,0x00,0x00,

/*--  ????:  o  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xF0,0x18,
0x0C,0x04,0x04,0x0C,0x18,0xF0,0xE0,0x00,0x00,0x03,0x0F,0x0C,0x10,0x10,0x10,0x10,
0x0C,0x0F,0x03,0x00,

/*--  ????:  l  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x20,0x20,0x20,0xE0,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x10,0x1F,0x1F,0x10,
0x10,0x10,0x00,0x00,

/*--  ????:  l  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x20,0x20,0x20,0xE0,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x10,0x1F,0x1F,0x10,
0x10,0x10,0x00,0x00,

/*--  ????:  e  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xF8,
0x48,0x44,0x44,0x44,0x4C,0x78,0x70,0x00,0x00,0x00,0x03,0x0F,0x0C,0x18,0x10,0x10,
0x10,0x08,0x04,0x00,

/*--  ????:  r  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x04,0x04,0xFC,
0xFC,0x10,0x08,0x04,0x04,0x0C,0x0C,0x00,0x10,0x10,0x10,0x1F,0x1F,0x10,0x10,0x10,
0x00,0x00,0x00,0x00,

/*--  ????:  :  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x0E,0x0E,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x1C,0x1C,
0x00,0x00,0x00,0x00,

/*--  ????:  u  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0xFC,0xFE,
0x00,0x00,0x00,0x04,0xFC,0xFE,0x00,0x00,0x00,0x00,0x0F,0x1F,0x18,0x10,0x10,0x08,
0x1F,0x0F,0x08,0x00,

/*--  ????:  c  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xF8,0x18,
0x04,0x04,0x04,0x3C,0x38,0x00,0x00,0x00,0x00,0x03,0x0F,0x0C,0x10,0x10,0x10,0x10,
0x08,0x06,0x00,0x00,

/*--  ????:  1  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x80,0x80,0x80,0xC0,0xE0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x10,0x1F,0x1F,0x10,
0x10,0x10,0x00,0x00,

/*--  ????:  6  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x80,0xC0,0x40,0x20,0x20,0x20,0xE0,0xC0,0x00,0x00,0x00,0xFC,0xFF,0x21,
0x10,0x08,0x08,0x08,0x18,0xF0,0xE0,0x00,0x00,0x01,0x07,0x0C,0x18,0x10,0x10,0x10,
0x08,0x0F,0x03,0x00,

/*--  ????:  9  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0xC0,0xC0,0x20,0x20,0x20,0x20,0xC0,0x80,0x00,0x00,0x00,0x1F,0x3F,0x60,
0x40,0x40,0x40,0x20,0x10,0xFF,0xFE,0x00,0x00,0x00,0x0C,0x1C,0x10,0x10,0x10,0x08,
0x0F,0x03,0x00,0x00,

/*--  ????:  8  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x80,0xC0,0x60,0x20,0x20,0x20,0x20,0x60,0xC0,0x80,0x00,0x00,0x87,0xEF,0x2C,
0x18,0x18,0x30,0x30,0x68,0xCF,0x83,0x00,0x00,0x07,0x0F,0x08,0x10,0x10,0x10,0x10,
0x18,0x0F,0x07,0x00,

/*--  ????:  u  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0xFC,0xFE,
0x00,0x00,0x00,0x04,0xFC,0xFE,0x00,0x00,0x00,0x00,0x0F,0x1F,0x18,0x10,0x10,0x08,
0x1F,0x0F,0x08,0x00,

/*--  ????:  s  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x78,
0xCC,0xC4,0x84,0x84,0x84,0x0C,0x1C,0x00,0x00,0x00,0x1E,0x18,0x10,0x10,0x10,0x11,
0x19,0x0F,0x06,0x00,

/*--  ????:  t  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x04,0x04,
0xFF,0xFF,0x04,0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x1F,0x10,0x10,
0x10,0x0C,0x00,0x00,

/*--  ????:  a  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x98,0xD8,
0x44,0x64,0x24,0x24,0xFC,0xF8,0x00,0x00,0x00,0x0F,0x1F,0x18,0x10,0x10,0x10,0x08,
0x1F,0x1F,0x10,0x18,

/*--  ????:  t  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x04,0x04,
0xFF,0xFF,0x04,0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x1F,0x10,0x10,
0x10,0x0C,0x00,0x00,

/*--  ????:  u  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0xFC,0xFE,
0x00,0x00,0x00,0x04,0xFC,0xFE,0x00,0x00,0x00,0x00,0x0F,0x1F,0x18,0x10,0x10,0x08,
0x1F,0x0F,0x08,0x00,

/*--  ????:  s  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x78,
0xCC,0xC4,0x84,0x84,0x84,0x0C,0x1C,0x00,0x00,0x00,0x1E,0x18,0x10,0x10,0x10,0x11,
0x19,0x0F,0x06,0x00,

/*--  ????:  :  --*/
/*--  ????18;  ????????????????????x??=12x24   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x0E,0x0E,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x1C,0x1C,
0x00,0x00,0x00,0x00,
};




void GPIO_Init_Periph(void)
{
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);
	
	GPIO_InitTypeDef GPIO_StructInit;
	GPIO_StructInit.GPIO_Mode = GPIO_Mode_Out_PP;
	GPIO_StructInit.GPIO_Pin = GPIO_Pin_15|GPIO_Pin_12|GPIO_Pin_11|GPIO_Pin_10|GPIO_Pin_9;
	GPIO_StructInit.GPIO_Speed = GPIO_Speed_50MHz;
	GPIO_Init(GPIOA, &GPIO_StructInit);
	
	GPIO_SetBits(GPIOA, GPIO_Pin_15|GPIO_Pin_12|GPIO_Pin_11|GPIO_Pin_10|GPIO_Pin_9);
}

void Send_Data(unsigned char Data)
{
	unsigned char i=0;
	LCD_CS_Clr;
	LCD_DC_Set;
	for (i=0;i<8;i++)
	{
		LCD_SCL_Clr;
		if (Data&0x80) {
            LCD_SDA_Set;
        }
		else {
            LCD_SDA_Clr;
        }
		LCD_SCL_Set;
		Data=Data<<1;
	}
	LCD_CS_Set;
}

void Send_Command(unsigned char Command)
{
	unsigned char i=0;
	LCD_CS_Clr;
	LCD_DC_Clr;
	for (i=0;i<8;i++)
	{
		LCD_SCL_Clr;
		if (Command&0x80) {
            LCD_SDA_Set;
        }
		else {
            LCD_SDA_Clr;
        }
		LCD_SCL_Set;
		Command=Command<<1;
	}
	LCD_CS_Set;
}

void UC1698_Init(void)
{
	/*reset*/
	LCD_RES_Clr;
	Delay_ms(200);			//??λ???????м?????????Щ??
	LCD_RES_Set;
	Delay_ms(200);
	Send_Command(0xe2);			//??????λ
	Delay_ms(20);
    
	/*power control*/
	Send_Command(0xeb);			//(26) 1/12??????????????
	Send_Command(0x2b);			//(6)  ??????DC-DC
	Send_Command(0x25);			//(5)  ???????????????????????????
	Send_Command(0x81);			//(10)  ???????????????????????0~255
	Send_Command(0x47);

	/*display control*/
	Send_Command(0xa4);			//(15)  ?????????е?
	Send_Command(0xa6);			//(16)  ??????????????????

	/*lcd control*/
	Send_Command(0xc4);			//(18) ?е?????????COM160-C0,  ?д????????SEG1-S240
   	Send_Command(0xa1);			//(14) 
	Send_Command(0xd1);			//(20) RGB-RGB-RGB-.....???
	Send_Command(0xd5);			//(21) 4k color mode??RRRR-GGGG-BBBB-RRRR-GGGG-BBBB??
	Send_Command(0x84);			//(11?? ?????????


	/*(19)n-line inversion*/
	Send_Command(0xc8);
	Send_Command(0x10);			//


	/*??????*/
	Send_Command(0xf4);			//(30) ?????
	Send_Command(0x43);			//start from 0
	Send_Command(0xf6);			//(32?? ?????
	Send_Command(0x8c);			//end:240

	Send_Command(0xf5);			//(31) ?????
    Send_Command(0x00);
	Send_Command(0xf7);			//(32) ?????
	Send_Command(0xa0);			// 128

	Send_Command(0xf8);			//(34) ?????趨????????????????????????1

	Send_Command(0x89);			//(12) ???????1?????????????????1 
        
	Send_Command(0xad);			//(17) ?????????л?????ON-OFF??????????????
}


void lcdscan(unsigned char dat1,unsigned char dat2)//???????д??dat2 ?????д??dat1
{
	unsigned char i,j;
	Send_Command(0x60);			//
	Send_Command(0x70);			// ???е????00
	Send_Command(0x00);			//
	Send_Command(0x10);			// ???е????00

	for(j=0;j<160;j++)
	{
		for(i=0;i<60;i++)
		{
			if(j%2==0)
			{
				Send_Data(dat1);
				Send_Data(dat1);
				Send_Data(dat1);      // д3???????????????????6????
			}
			else
			{
				Send_Data(dat2);
				Send_Data(dat2);
				Send_Data(dat2);
			}
		}
	}
}

void words(unsigned char x,unsigned char y,unsigned char type,unsigned char *p)			//type=1,ascii;type=2,Chinese character
{
	unsigned char i,k,j,m,n,l,x0,dat0,dat1,dat2,dat3,dat4,dat5,dat6;
	x=00+x;//?????????3???????3?????????RGB??
	x0=0x00|(x&0x0f);
	x=0x10|((x&0xf0)>>4);         //????4λ
	for(i=0;i<3;i++)//???? 3?????  3*8=24??
	{
		n=i*12*type;
		for(j=0;j<8;j++)//???? ??????8????
		{
			m=i*8+j;       //?8?е?任?????3?????
			Send_Command(0x89);//SET RAM ADDRESS CONTROL	 			
			Send_Command(x0);//Set Column Address LSB CA[3:0]
			Send_Command(x);//Set Column Address MSB CA[7:4]
			Send_Command(0x60|((y+m)&0x0f));//Set Row Address LSB RA [3:0]
			Send_Command(0x70|(((y+m)&0xf0)>>4));//Set Row Address MSB RA [7:4]

			for(k=0;k<2*type;k++)
//??????? ?????????6???????????????6?????? 2??12??3???????????2???????12??
			{
				l=k*6+n;
				dat6=0x01<<j;                    //??????λ??j???8λ???????
				dat0=(*(p+l))&dat6;              //????????????
				dat0=dat0>>j;
				dat0<<=7;                        //??????  ????λ

				dat1=(*(p+l+1))&dat6;             //????????????
				dat1=dat1>>j;
				dat1<<=3;                        //??????  ????λ

				dat2=*(p+2+l)&dat6;              //????????????
				dat2=dat2>>j;
				dat2<<=7;                         //??????  ????λ

				dat3=(*(p+3+l))&dat6;             //????????????
				dat3=dat3>>j;
				dat3<<=3;                          //??????  ????λ

				dat4=(*(p+4+l))&dat6;             //????????????
				dat4=dat4>>j;
				dat4<<=7;                          //??????  ????λ

				dat5=(*(p+5+l))&dat6;              //????????????
				dat5=dat5>>j;
				dat5<<=3;                          //??????  ????λ

                                                                   //????????8λ??
				Send_Data(dat0|dat1);
				Send_Data(dat2|dat3);
				Send_Data(dat4|dat5);

			}
		Send_Command(0x88);//SET RAM ADDRESS CONTROL??????? 		
		}
	}
	Send_Command(0x89);//SET RAM ADDRESS CONTROL
	
}

void character(void)
{
	unsigned char *q;
	unsigned char i,j;
	//temp[3],table[6];
	lcdscan(0x00,0x00);
for(i=0;i<4;i++)//
	{
		q=hanzi+i*72;
      j=9*i+68; 	//	j=8*i+4;// ?????????24*24??????????????24??????????8??
		words(j,40,2,q);
	}

	for(i=0;i<11;i++)//controller:
	{
		q=zimu+i*36;
		j=4*i+68;
		words(j,70,1,q);
	}

	for(i=11;i<18;i++)//uc1698u
	{
		q=zimu+i*36;
		j=4*(i-11)+68;
		words(j,100,1,q);
	}
	for(i=18;i<25;i++)//status:
	{
		q=zimu+i*36;
		j=4*(i-18)+68;
		words(j,130,1,q);
	}

}
